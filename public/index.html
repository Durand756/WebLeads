<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - SEO & Email Marketing SaaS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .auth-card {
            background: white;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        .logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo h1 {
            color: #667eea;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .logo p {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group input.error {
            border-color: #dc3545;
        }

        .error-text {
            color: #dc3545;
            font-size: 12px;
            margin-top: 4px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .auth-switch {
            text-align: center;
            margin-top: 24px;
            color: #666;
        }

        .auth-switch a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        .hidden {
            display: none !important;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .password-requirements {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        .requirement {
            margin: 2px 0;
        }

        .requirement.valid {
            color: #28a745;
        }

        .requirement.invalid {
            color: #dc3545;
        }

        .requirement::before {
            content: "â€¢ ";
        }
    </style>
</head>
<body>
    <div class="auth-card">
        <div class="logo">
            <h1>SaaS Hub</h1>
            <p>SEO Analysis & Email Marketing</p>
        </div>

        <div id="messageContainer"></div>

        <form id="signupForm">
            <div class="form-group">
                <label for="signupName">Full Name</label>
                <input type="text" id="signupName" name="name" required autocomplete="name">
                <div id="nameError" class="error-text hidden"></div>
            </div>
            
            <div class="form-group">
                <label for="signupEmail">Email Address</label>
                <input type="email" id="signupEmail" name="email" required autocomplete="email">
                <div id="emailError" class="error-text hidden"></div>
            </div>
            
            <div class="form-group">
                <label for="signupPassword">Password</label>
                <input type="password" id="signupPassword" name="password" required minlength="6" autocomplete="new-password">
                <div id="passwordError" class="error-text hidden"></div>
                <div class="password-requirements">
                    <div id="lengthReq" class="requirement invalid">At least 6 characters</div>
                    <div id="letterReq" class="requirement invalid">At least one letter</div>
                    <div id="numberReq" class="requirement invalid">At least one number</div>
                </div>
            </div>
            
            <button type="submit" class="btn" id="signupBtn">
                Create Account
                <span id="signupSpinner" class="spinner hidden"></span>
            </button>
        </form>
        
        <div class="auth-switch">
            Already have an account? <a id="loginLink">Sign in</a>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = '/api';
        
        // DOM Elements
        const signupForm = document.getElementById('signupForm');
        const signupBtn = document.getElementById('signupBtn');
        const signupSpinner = document.getElementById('signupSpinner');
        const messageContainer = document.getElementById('messageContainer');
        const loginLink = document.getElementById('loginLink');
        
        const nameInput = document.getElementById('signupName');
        const emailInput = document.getElementById('signupEmail');
        const passwordInput = document.getElementById('signupPassword');
        
        const nameError = document.getElementById('nameError');
        const emailError = document.getElementById('emailError');
        const passwordError = document.getElementById('passwordError');
        
        // Password requirement elements
        const lengthReq = document.getElementById('lengthReq');
        const letterReq = document.getElementById('letterReq');
        const numberReq = document.getElementById('numberReq');

        // Utility functions
        function showMessage(message, type = 'info') {
            messageContainer.innerHTML = `<div class="message ${type}">${message}</div>`;
            setTimeout(() => {
                if (messageContainer.innerHTML.includes(message)) {
                    messageContainer.innerHTML = '';
                }
            }, 5000);
        }

        function clearMessage() {
            messageContainer.innerHTML = '';
        }

        function showSpinner() {
            signupSpinner.classList.remove('hidden');
        }

        function hideSpinner() {
            signupSpinner.classList.add('hidden');
        }

        function disableButton() {
            signupBtn.disabled = true;
        }

        function enableButton() {
            signupBtn.disabled = false;
        }

        function showFieldError(errorElement, message) {
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function hideFieldError(errorElement) {
            errorElement.classList.add('hidden');
        }

        function clearAllErrors() {
            hideFieldError(nameError);
            hideFieldError(emailError);
            hideFieldError(passwordError);
            
            nameInput.classList.remove('error');
            emailInput.classList.remove('error');
            passwordInput.classList.remove('error');
        }

        // Validation functions
        function validateName(name) {
            if (!name || name.trim().length < 2) {
                return 'Name must be at least 2 characters long';
            }
            return null;
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!email) {
                return 'Email is required';
            }
            if (!emailRegex.test(email)) {
                return 'Please enter a valid email address';
            }
            return null;
        }

        function validatePassword(password) {
            if (!password) {
                return 'Password is required';
            }
            if (password.length < 6) {
                return 'Password must be at least 6 characters long';
            }
            if (!/[a-zA-Z]/.test(password)) {
                return 'Password must contain at least one letter';
            }
            if (!/[0-9]/.test(password)) {
                return 'Password must contain at least one number';
            }
            return null;
        }

        function updatePasswordRequirements(password) {
            // Length requirement
            if (password.length >= 6) {
                lengthReq.classList.remove('invalid');
                lengthReq.classList.add('valid');
            } else {
                lengthReq.classList.remove('valid');
                lengthReq.classList.add('invalid');
            }

            // Letter requirement
            if (/[a-zA-Z]/.test(password)) {
                letterReq.classList.remove('invalid');
                letterReq.classList.add('valid');
            } else {
                letterReq.classList.remove('valid');
                letterReq.classList.add('invalid');
            }

            // Number requirement
            if (/[0-9]/.test(password)) {
                numberReq.classList.remove('invalid');
                numberReq.classList.add('valid');
            } else {
                numberReq.classList.remove('valid');
                numberReq.classList.add('invalid');
            }
        }

        function validateForm() {
            let isValid = true;
            clearAllErrors();

            // Validate name
            const nameValidation = validateName(nameInput.value.trim());
            if (nameValidation) {
                showFieldError(nameError, nameValidation);
                nameInput.classList.add('error');
                isValid = false;
            }

            // Validate email
            const emailValidation = validateEmail(emailInput.value.trim());
            if (emailValidation) {
                showFieldError(emailError, emailValidation);
                emailInput.classList.add('error');
                isValid = false;
            }

            // Validate password
            const passwordValidation = validatePassword(passwordInput.value);
            if (passwordValidation) {
                showFieldError(passwordError, passwordValidation);
                passwordInput.classList.add('error');
                isValid = false;
            }

            return isValid;
        }

        // API function
        async function makeRequest(url, options = {}) {
            const defaultHeaders = {
                'Content-Type': 'application/json',
            };

            const config = {
                headers: {
                    ...defaultHeaders,
                    ...options.headers
                },
                ...options
            };

            console.log(`Making request to ${url}`, config);
            
            try {
                const response = await fetch(url, config);
                console.log(`Response from ${url}:`, response.status, response.statusText);
                
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    const data = await response.json();
                    console.log('Response data:', data);
                    return { response, data };
                } else {
                    const text = await response.text();
                    console.log('Non-JSON response:', text);
                    return { response, data: { error: text || 'Invalid server response' } };
                }
            } catch (error) {
                console.error(`Request failed for ${url}:`, error);
                throw error;
            }
        }

        // Main signup handler
        async function handleSignup(e) {
            e.preventDefault();
            
            console.log('Signup form submitted');
            
            if (!validateForm()) {
                console.log('Form validation failed');
                return;
            }

            const name = nameInput.value.trim();
            const email = emailInput.value.trim();
            const password = passwordInput.value;

            console.log('Signup data:', { name, email, password: '***' });

            disableButton();
            showSpinner();
            clearMessage();

            try {
                const { response, data } = await makeRequest(`${API_BASE}/signup`, {
                    method: 'POST',
                    body: JSON.stringify({ name, email, password })
                });

                if (response.ok) {
                    console.log('Signup successful:', data);
                    
                    // Store the token
                    localStorage.setItem('token', data.token);
                    
                    showMessage('Account created successfully! Redirecting...', 'success');
                    
                    // Reset form
                    signupForm.reset();
                    updatePasswordRequirements('');
                    
                    // Redirect to dashboard after 2 seconds
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                    
                } else {
                    console.log('Signup failed:', data);
                    
                    // Handle specific error cases
                    if (data.error && data.error.includes('email')) {
                        showFieldError(emailError, data.error);
                        emailInput.classList.add('error');
                    } else if (data.error && data.error.includes('password')) {
                        showFieldError(passwordError, data.error);
                        passwordInput.classList.add('error');
                    } else {
                        showMessage(data.error || 'Signup failed. Please try again.', 'error');
                    }
                }
            } catch (error) {
                console.error('Signup error:', error);
                
                if (error.message.includes('Failed to fetch')) {
                    showMessage('Unable to connect to server. Please check your internet connection.', 'error');
                } else {
                    showMessage('Network error. Please try again.', 'error');
                }
            } finally {
                enableButton();
                hideSpinner();
            }
        }

        // Event listeners
        function setupEventListeners() {
            // Form submission
            signupForm.addEventListener('submit', handleSignup);

            // Real-time password validation
            passwordInput.addEventListener('input', function() {
                updatePasswordRequirements(this.value);
            });

            // Login link
            loginLink.addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = '/';
            });

            // Real-time field validation (optional)
            nameInput.addEventListener('blur', function() {
                const validation = validateName(this.value.trim());
                if (validation) {
                    showFieldError(nameError, validation);
                    this.classList.add('error');
                } else {
                    hideFieldError(nameError);
                    this.classList.remove('error');
                }
            });

            emailInput.addEventListener('blur', function() {
                const validation = validateEmail(this.value.trim());
                if (validation) {
                    showFieldError(emailError, validation);
                    this.classList.add('error');
                } else {
                    hideFieldError(emailError);
                    this.classList.remove('error');
                }
            });

            passwordInput.addEventListener('blur', function() {
                const validation = validatePassword(this.value);
                if (validation) {
                    showFieldError(passwordError, validation);
                    this.classList.add('error');
                } else {
                    hideFieldError(passwordError);
                    this.classList.remove('error');
                }
            });

            console.log('Event listeners set up');
        }

        // Initialize the page
        function init() {
            console.log('Initializing signup page...');
            
            // Check if user is already logged in
            const token = localStorage.getItem('token');
            if (token) {
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    if (payload.exp > Date.now() / 1000) {
                        console.log('User already logged in, redirecting...');
                        window.location.href = '/';
                        return;
                    } else {
                        localStorage.removeItem('token');
                    }
                } catch (error) {
                    localStorage.removeItem('token');
                }
            }

            setupEventListeners();
            
            // Focus on first input
            nameInput.focus();
            
            console.log('Signup page initialized');
        }

        // Wait for DOM to be ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // Global error handler
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            showMessage('An unexpected error occurred. Please try again.', 'error');
        });

        console.log('Signup page script loaded');
    </script>
</body>
</html>
